<div class="container">

    <div class="col-sm-12 col-md-10 col-lg-8 bg-white my-3 p-4 shadow-lg mx-auto rounded">
      <div class="row">
        <div class="col-4">
          <%= image_tag @plan.user.get_profile_image(90, 90), class: "rounded-circle mx-auto d-block" %>
          <div class="text-center mb-1"><%= link_to @plan.user.name, user_path(@plan.user) %></div>
        </div>
        <div class="col my-auto">
          <h5><%= @plan.title %></h5>
          <%=safe_join(@plan.body.split("\n"),tag(:br)) %>
        </div>
      </div>

      <% @plan_details.each do |plan_detail| %>
        <div class="col p-3 my-2" style="background-color: #CDD3E8;"><%= plan_detail.title %></div>
        <div class="col p-3 my-2" style="background-color: #CDD3E8;"><%= plan_detail.body %></div>
        <div class="col p-3 my-2" style="background-color: #CDD3E8;"><%= plan_detail.address %></div>
      <% end %>

      <div class="row">
        <% @plan_tags.each do |tag| %>
          <div class="col text-center mx-4">
            <i class="fa-sharp fa-solid fa-tag"></i>
            <%= link_to tag.name, search_tag_path(tag_id: tag.id) %>
          </div>
        <% end %>

      </div>

      <div class="row">
        <!--コメントカウント非同期化テンプレート-->
        <div class="col-6 text-center comment_counter"><%= render 'public/comments/counter', plan: @plan %></div>
        <!--いいね非同期化テンプレート-->
        <div class="col-6 text-center like_buttons_<%= @plan.id %>"><%= render 'public/likes/like', plan: @plan %></div>
      </div>

      <% if @plan.user == current_user %>
      <div class="row mt-3">
        <div class="col text-center">
          <%= link_to edit_plan_path(@plan), class: "btn btn-warning mx-2" do %>
            <i class="fa-solid fa-pen-to-square fa-lg px-3 mx-2"></i>
          <% end %>
          <%= link_to plan_path(@plan), method: :delete, class: "btn btn-danger mx-2", data: { confirm: "投稿を削除しますか？" } do %>
            <i class="fa-solid fa-trash fa-lg px-2 mx-2" style="color: #ffffff;"></i>
          <% end %>
        </div>
      </div>
      <% end %>
    </div>

    <div class="map">
      <div id="map" class="col-sm-12 col-md-10 col-lg-8 mx-auto" style="height: 300px;" data-plan-details='<%= @plan_details.to_json(include: { plan: { include: { user: { only: [:name] } } } }, only: [:latitude, :longitude, :title, :address]) %>'></div>
    </div>

    <!-- コメント一覧非同期化テンプレート -->
    <div class="row comment-index mx-auto">
      <%= render 'public/comments/index', plan: @plan %>
    </div>

    <!-- コメント送信非同期化テンプレート -->
    <div class="row mx-auto">
      <%= render 'public/comments/form', { plan: @plan, comment: @comment } %>
    </div>

</div>

<!--<script>
  function initMap(){
    // 地図の位置情報(緯度・経度)を取得
    let mapPosition = {lat: <%#= @plan_details.latitude || 0 %> , lng: <%#= @plan_details.longitude || 0 %> };
    let map = new google.maps.Map(document.getElementById('map'), {
      zoom: 15,
      center: mapPosition
    });
    let transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);

    let contentString = '【住所】<%#= @post.address %>';
    let infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    let marker = new google.maps.Marker({
      position: mapPosition,
      map: map,
      title: contentString
    });

    marker.addListener('click', function(){
      infowindow.open(map, marker);
    });
  }
</script>-->

<!--<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['Maps_API_Key'] %>&callback=initMap" async defer></script>-->

<%= javascript_pack_tag 'map', 'data-turbolinks-track': 'reload' %>